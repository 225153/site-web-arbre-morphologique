<div class="app-container" dir="rtl">

  <!-- Loading -->
  @if (loading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>ุฌุงุฑู ุชููุฆุฉ ุงููุญูู ุงูุตุฑูู...</p>
    </div>
  }

  @if (!loading()) {
    <!-- Header -->
    <header class="header">
      <h1>๐ณ ุงููุญูู ุงูุตุฑูู ุงูุนุฑุจู</h1>
      <p class="subtitle">ูุญุฑู ุชุญููู ุงูุตุฑู ุงูุนุฑุจู โ ุจููุฉ ุดุฌุฑุฉ ุซูุงุฆูุฉ + ุฌุฏูู ุชุฌุฒุฆุฉ</p>
      <div class="stats">
        <span class="stat">๐ฟ ุงูุฌุฐูุฑ: {{ totalRacines() }}</span>
        <span class="stat">โ๏ธ ุงูุฃูุฒุงู: {{ totalSchemes() }}</span>
      </div>
    </header>

    <!-- Messages -->
    @if (message()) {
      <div class="alert alert-success">{{ message() }}</div>
    }
    @if (erreur()) {
      <div class="alert alert-error">{{ erreur() }}</div>
    }

    <!-- Navigation -->
    <nav class="tab-nav">
      <button [class.active]="activeTab() === 'racines'" (click)="setTab('racines')">
        ๐ฑ ุงูุฌุฐูุฑ
      </button>
      <button [class.active]="activeTab() === 'derives'" (click)="setTab('derives')">
        ๐ ุงููุดุชูุงุช
      </button>
      <button [class.active]="activeTab() === 'validation'" (click)="setTab('validation')">
        โ ุงูุชุญูู
      </button>
      <button [class.active]="activeTab() === 'schemes'" (click)="setTab('schemes')">
        โ๏ธ ุงูุฃูุฒุงู
      </button>
      <button [class.active]="activeTab() === 'arbre'" (click)="setTab('arbre')">
        ๐ณ ุงูุดุฌุฑุฉ
      </button>
    </nav>

    <!-- TAB: RACINES -->
    @if (activeTab() === 'racines') {
      <section class="tab-content">
        <h2>ุฅุฏุงุฑุฉ ุงูุฌุฐูุฑ</h2>

        <div class="input-group">
          <label>ุงูุฌุฐุฑ (3 ุฃุญุฑู ุนุฑุจูุฉ):</label>
          <input
            type="text"
            [value]="racineInput()"
            (input)="racineInput.set($any($event.target).value)"
            placeholder="ูุซุงู: ูุชุจ"
            maxlength="10"
            class="arabic-input"
          />
          <div class="btn-row">
            <button class="btn btn-primary" (click)="ajouterRacine()">โ ุฅุถุงูุฉ</button>
            <button class="btn btn-info" (click)="chercherRacine()">๐ ุจุญุซ</button>
            <button class="btn btn-danger" (click)="supprimerRacine()">๐๏ธ ุญุฐู</button>
          </div>
        </div>

        <div class="input-group">
          <label>ุชุญููู ุฌุฐูุฑ ูู ูุต:</label>
          <textarea
            [value]="racinesTexte()"
            (input)="racinesTexte.set($any($event.target).value)"
            placeholder="ุฃุฏุฎู ูุตุงู ูุญุชูู ุนูู ุฌุฐูุฑ (ุฌุฐุฑ ูุงุญุฏ ูู ูู ุณุทุฑ ุฃู ููุตููุฉ ุจูุณุงูุฉ)"
            rows="4"
            class="arabic-input"
          ></textarea>
          <button class="btn btn-primary" (click)="chargerRacines()">๐ฅ ุชุญููู ุงูุฌุฐูุฑ</button>
        </div>
      </section>
    }

    <!-- TAB: DรRIVรS -->
    @if (activeTab() === 'derives') {
      <section class="tab-content">
        <h2>ุชูููุฏ ุงููุดุชูุงุช</h2>

        <div class="input-group">
          <label>ุงูุฌุฐุฑ:</label>
          <input
            type="text"
            [value]="deriveRacine()"
            (input)="deriveRacine.set($any($event.target).value)"
            placeholder="ูุซุงู: ูุชุจ"
            maxlength="10"
            class="arabic-input"
          />
        </div>

        <div class="input-group">
          <label>ุงููุฒู (ุงุฎุชูุงุฑู ููุชูููุฏ ุงููุฑุฏู):</label>
          <input
            type="text"
            [value]="deriveSchema()"
            (input)="deriveSchema.set($any($event.target).value)"
            placeholder="ูุซุงู: ููุนููู"
            class="arabic-input"
          />
        </div>

        <div class="btn-row">
          <button class="btn btn-primary" (click)="genererTousDerives()">๐ ุชูููุฏ ุงููู (ุนุฑุถ ููุท)</button>
          <button class="btn btn-success" (click)="genererEtStockerTous()">๐พ ุชูููุฏ + ุชุฎุฒูู ุงููู</button>
          <button class="btn btn-info" (click)="genererDerive()">๐ ุชูููุฏ ูุฑุฏู</button>
          <button class="btn btn-success" (click)="genererEtStockerDerive()">๐พ ุชูููุฏ + ุชุฎุฒูู ูุฑุฏู</button>
        </div>

        <!-- Dรฉrivรฉs gรฉnรฉrรฉs -->
        @if (derivesGeneres().length > 0) {
          <div class="results-box">
            <h3>ุงููุดุชูุงุช ุงููููุฏุฉ ({{ derivesGeneres().length }})</h3>
            <table class="data-table">
              <thead>
                <tr><th>ุงููุดุชู</th><th>ุงููุฒู</th></tr>
              </thead>
              <tbody>
                @for (d of derivesGeneres(); track d.mot) {
                  <tr><td class="arabic-cell">{{ d.mot }}</td><td class="arabic-cell">{{ d.schema }}</td></tr>
                }
              </tbody>
            </table>
          </div>
        }

        <!-- Dรฉrivรฉs stockรฉs -->
        <div class="results-box">
          <h3>ุงููุดุชูุงุช ุงููุฎุฒูุฉ</h3>
          <button class="btn btn-info btn-sm" (click)="afficherDerivesStockes()">๐ ุชุญุฏูุซ</button>
          @if (derivesStockes().length > 0) {
            <table class="data-table">
              <thead>
                <tr><th>ุงููุดุชู</th><th>ุงููุฒู</th><th>ุฅุฌุฑุงุก</th></tr>
              </thead>
              <tbody>
                @for (d of derivesStockes(); track d.mot) {
                  <tr>
                    <td class="arabic-cell">{{ d.mot }}</td>
                    <td class="arabic-cell">{{ d.schema }}</td>
                    <td><button class="btn btn-danger btn-sm" (click)="supprimerDerive(d.mot)">๐๏ธ</button></td>
                  </tr>
                }
              </tbody>
            </table>
          } @else {
            <p class="empty">ูุง ุชูุฌุฏ ูุดุชูุงุช ูุฎุฒูุฉ</p>
          }
        </div>
      </section>
    }

    <!-- TAB: VALIDATION -->
    @if (activeTab() === 'validation') {
      <section class="tab-content">
        <h2>ุงูุชุญูู ูู ูููุฉ ูุดุชูุฉ</h2>

        <div class="input-group">
          <label>ุงูุฌุฐุฑ:</label>
          <input
            type="text"
            [value]="validationRacine()"
            (input)="validationRacine.set($any($event.target).value)"
            placeholder="ูุซุงู: ูุชุจ"
            maxlength="10"
            class="arabic-input"
          />
        </div>

        <div class="input-group">
          <label>ุงููููุฉ ุงููุดุชูุฉ:</label>
          <input
            type="text"
            [value]="validationMot()"
            (input)="validationMot.set($any($event.target).value)"
            placeholder="ูุซุงู: ูุงุชุจ"
            class="arabic-input"
          />
        </div>

        <button class="btn btn-primary" (click)="validerMot()">โ ุชุญูู</button>

        @if (validationResultat()) {
          <div class="validation-result" [class.valid]="validationResultat()!.valide" [class.invalid]="!validationResultat()!.valide">
            @if (validationResultat()!.valide) {
              <span>โ ุตุญูุญุฉ โ ุงููุฒู: {{ validationResultat()!.schema }}</span>
            } @else {
              <span>โ ุบูุฑ ูุทุงุจูุฉ ูุฃู ูุฒู ูู ุฃูุฒุงู ูุฐุง ุงูุฌุฐุฑ</span>
            }
          </div>
        }
      </section>
    }

    <!-- TAB: SCHEMES -->
    @if (activeTab() === 'schemes') {
      <section class="tab-content">
        <h2>ุฅุฏุงุฑุฉ ุงูุฃูุฒุงู ุงูุตุฑููุฉ</h2>

        <div class="input-group">
          <label>ุงุณู ุงููุฒู:</label>
          <input
            type="text"
            [value]="nouveauSchemeNom()"
            (input)="nouveauSchemeNom.set($any($event.target).value)"
            placeholder="ูุซุงู: ููุนูุงู"
            class="arabic-input"
          />
        </div>
        <div class="input-group">
          <label>ููุท ุงููุฒู:</label>
          <input
            type="text"
            [value]="nouveauSchemePattern()"
            (input)="nouveauSchemePattern.set($any($event.target).value)"
            placeholder="ูุซุงู: 1ู2ู3"
            class="arabic-input"
          />
        </div>
        <div class="input-group">
          <label>ูุตู (ุงุฎุชูุงุฑู):</label>
          <input
            type="text"
            [value]="nouveauSchemeDesc()"
            (input)="nouveauSchemeDesc.set($any($event.target).value)"
            placeholder="ูุตู ุงููุฒู"
            class="arabic-input"
          />
        </div>
        <button class="btn btn-primary" (click)="ajouterScheme()">โ ุฅุถุงูุฉ ูุฒู</button>

        <div class="results-box">
          <h3>ุงูุฃูุฒุงู ุงููุชุงุญุฉ ({{ schemesList().length }})</h3>
          <table class="data-table">
            <thead>
              <tr><th>ุงูุงุณู</th><th>ุงูููุท</th><th>ุงููุตู</th><th>ุฅุฌุฑุงุก</th></tr>
            </thead>
            <tbody>
              @for (s of schemesList(); track s.nom) {
                <tr>
                  <td class="arabic-cell">{{ s.nom }}</td>
                  <td class="arabic-cell">{{ s.modele }}</td>
                  <td>{{ s.id }}</td>
                  <td><button class="btn btn-danger btn-sm" (click)="supprimerScheme(s.nom)">๐๏ธ</button></td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </section>
    }

    <!-- TAB: ARBRE -->
    @if (activeTab() === 'arbre') {
      <section class="tab-content">
        <h2>๐ณ ุนุฑุถ ุงูุดุฌุฑุฉ</h2>
        <button class="btn btn-info" (click)="rafraichirArbre()">๐ ุชุญุฏูุซ</button>

        @if (racinesList().length > 0) {
          <table class="data-table">
            <thead>
              <tr><th>ุงูุฌุฐุฑ</th><th>ุนุฏุฏ ุงููุดุชูุงุช</th><th>ุงููุดุชูุงุช</th></tr>
            </thead>
            <tbody>
              @for (r of racinesList(); track r.racine) {
                <tr>
                  <td class="arabic-cell racine-cell">{{ r.racine }}</td>
                  <td>{{ r.nombre_derives }}</td>
                  <td class="arabic-cell">
                    @if (r.derives && r.derives.length > 0) {
                      @for (d of r.derives; track d.mot) {
                        <span class="derive-tag">{{ d.mot }} <small>({{ d.schema }})</small></span>
                      }
                    } @else {
                      <span class="empty">โ</span>
                    }
                  </td>
                </tr>
              }
            </tbody>
          </table>
        } @else {
          <p class="empty">ุงูุดุฌุฑุฉ ูุงุฑุบุฉ โ ุฃุถู ุฌุฐูุฑุงู ุฃููุงู</p>
        }
      </section>
    }
  }
</div>